<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Raqkid Speed Test</title>
  <link rel="icon" type="image/png" href="icon.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Top Navbar -->
  <header>
    <div class="menu-btn" onclick="toggleMenu()">â˜° Menu</div>
    <div class="ping" id="pingDisplay">PING: -- ms</div>
  </header>

  <!-- Sidebar Menu -->
  <nav id="sidebar" class="sidebar">
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="botinfo.html">Bot Info</a></li>
    </ul>
  </nav>

  <!-- Speed Test Section -->
  <main class="about-container">
    <h1>RAQkid Speed Test</h1>
    <p style="color: white;">Click the button below to test your internet speed.</p>

    <div id="speed-box">
      <p><strong>IP:</strong> <span id="userIp">Loading...</span></p>
      <p><strong>Location:</strong> <span id="userLocation">Loading...</span></p>
      <p><strong>Download Speed:</strong> <span id="downloadSpeed">Waiting...</span></p>
      <p><strong>Upload Speed:</strong> <span id="uploadSpeed">Waiting...</span></p>

      <!-- Start Button -->
      <button id="startBtn" class="discord-btn" onclick="startSpeedTest()">
        Start Speed Test
      </button>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    Powered by NodeJS | Made by Mangthomas
  </footer>

  <!-- Scripts -->
  <script>
    // Sidebar Toggle
    function toggleMenu() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    // Ping Color Logic
    function updatePing(ms) {
      const pingDisplay = document.getElementById("pingDisplay");
      pingDisplay.textContent = `PING: ${ms} ms`;
      if (ms <= 99) pingDisplay.style.color = "#00ff7f";
      else if (ms <= 199) pingDisplay.style.color = "#FFD700";
      else pingDisplay.style.color = "#FF4500";
    }

    // Fetch User IP & Location
    async function fetchUserDetails() {
      try {
        const response = await fetch("https://ipapi.co/json/");
        const data = await response.json();
        document.getElementById("userIp").textContent = data.ip;
        document.getElementById("userLocation").textContent =
          `${data.city}, ${data.region}, ${data.country_name}`;
      } catch {
        document.getElementById("userIp").textContent = "Failed";
        document.getElementById("userLocation").textContent = "Unavailable";
      }
    }
    fetchUserDetails();

    // Start Speed Test using Cloudflare API
    async function startSpeedTest() {
      const startBtn = document.getElementById("startBtn");
      startBtn.disabled = true;
      startBtn.textContent = "Please wait...";

      document.getElementById("downloadSpeed").textContent = "Testing...";
      document.getElementById("uploadSpeed").textContent = "Testing...";

      try {
        // Cloudflare Speed Test API
        const res = await fetch("https://speed.cloudflare.com/__down?bytes=5000000");
        const startTime = performance.now();
        await res.blob();
        const endTime = performance.now();

        const duration = (endTime - startTime) / 1000;
        const fileSize = 5 * 1024 * 1024 * 8; // 5MB in bits
        const downloadMbps = (fileSize / duration / 1024 / 1024).toFixed(2);
        document.getElementById("downloadSpeed").textContent = `${downloadMbps} Mbps`;
      } catch (error) {
        document.getElementById("downloadSpeed").textContent = "Failed";
      }

      try {
        // Upload Test (1MB data)
        const startTime = performance.now();
        const uploadData = new Blob([new ArrayBuffer(1 * 1024 * 1024)]);
        await fetch("https://httpbin.org/post", { method: "POST", body: uploadData });
        const endTime = performance.now();

        const duration = (endTime - startTime) / 1000;
        const fileSize = 1 * 1024 * 1024 * 8;
        const uploadMbps = (fileSize / duration / 1024 / 1024).toFixed(2);
        document.getElementById("uploadSpeed").textContent = `${uploadMbps} Mbps`;
      } catch (error) {
        document.getElementById("uploadSpeed").textContent = "Failed";
      }

      // Update Ping Dynamically
      const pingStart = performance.now();
      await fetch("https://1.1.1.1/cdn-cgi/trace");
      const pingEnd = performance.now();
      const pingMs = Math.round(pingEnd - pingStart);
      updatePing(pingMs);

      startBtn.disabled = false;
      startBtn.textContent = "Start Speed Test";
    }
  </script>
</body>
</html>
